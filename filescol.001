AK155  5.02.2005 <filescol.pas> filescol.001

  В данный момент (2.08) резервирование памяти под файловые записи
делается по максимальной длине длинного имени. Если резервировать
по фактической длине, то в некоторых местах возникают проблемы
в связи с переименованием файла или каталога. В этих случаях в
файловой записи вписывается новое имя, что существенно для одной
единственной записи - для той, которая соответствует файлу под
курсором. Если в запись не внести новое имя, то при перечитывании
каталога (новое) имя этого файла не совпадёт с именем в записи,
соответствующей  (старой) позиции курсора, и поэтому курсор не
последует за файлом.
  Проблема состоит в том, что если изменение длины имени требует создания
новой записи и коррекции указателя на эту запись, так как в старой
записи может быть недостаточно места для размещения нового имени.
  В тех местах, где требуется переименование, добраться до указателя,
который на самом деле надо корректировать, не так то просто.
Корректировать надо указатель в коллекции файлов (Drive^.Files^.Items^[n]),
а доступна, лучшем случае, только коллекция выделенных файлов, в которой
корректировать что-либо никакого смысла нет.
  Я попытался было решить эту проблему, но там указатель столько раз
копируется, что потребуется очень много переделок.
  С другой стороны, сам подход, когда для файловых операций формируется
коллекция выделенных файлов, кажется очень странным. Смысла я в этом не
вижу никакого, а работы лишней это создаёт немало. Если будет работа идти
непосредственно с основной коллекцией, то и с переименованием будет
проще.
  Так что вопрос об экономии памяти на файловых записях откладываю до
решения вопроса об исключении коллекций выделенных файлов.
  Те места, где требуется переименование файловой записи, помечены
комментарием {!RLN} (Rename Long Name).
