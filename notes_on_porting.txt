
how to build:
fpc ./dn.pas

не забываем добавлять // changed by unxed
и // added by unxed
и // commented by unxed
возле всех изменений.

и помечать изменения с потенциальной потерей функциональности как fixme.

--

Код:
    exrules: array[Low(THighliteRule)..Succ(High(THighliteRule))] of PChar;

Ошибка:
highlite.pas(1118,40) Error: range check error while evaluating constants (4 must be between 0 and 3)

Решение:
Добавить в THighliteRule дополнительное поле, а Succ убрать:
  THighliteRule = (
    hrCommentStarts,
    hrCommentStrings,
    hrKeywords1,
    hrKeywords2,
    hrExtra
    );
    // ...
    exrules: array[Low(THighliteRule)..High(THighliteRule)] of PChar;

Коммит:
https://github.com/unxed/dn2l/commit/5b020d7808c9165ebf4346d6243d3b04586365a9

--

Код:
      FC^.AtReplace(I, nil); {-$VOL}

Ошибка:
flpanelx.pas(604,11) Error: identifier idents no member "AtReplace"

Решение:
Заменить проблемную строчку на
      FC^.AtDelete(I);
      FC^.AtInsert(I, nil);
      {-$VOL}

Коммит:
https://github.com/unxed/dn2l/commit/a176a28e22ae347b25d74aeb55089e9644a5e30e

--

Код:
flpanelx.pas(759,12) Error: identifier idents no member "Sort"

Ошибка:
    Files^.Sort;

Тип Files — PFilesCollection, описан в filescol.pas
Наследуется от системной TSortedCollection.

Решение:
В системной TSortedCollection метода Sort нет:
https://www.freepascal.org/docs-html/rtl/objects/tsortedcollection.html
Закомментим пока вызов Sort (возможно, там автоматическая сортировка, но это не точно).

Коммит:
https://github.com/unxed/dn2l/commit/739ff4b89d6bc6dcf120f1f0f3de25af224b8c02

--

Код:
PDir := NewStr(ArcName+':\')

Ошибка:
Error: Incompatible types: got "PShortString" expected "PString"

Решение:
Можно заменить проблемный код на
          AssignStr(PDir, ArcName+':\')
, но тогда всё ломается дальше, вот тут:
        UpFile^.Owner := PDir;

Поэтому поменял определение PDir на
      PDir: PShortString;

(см., например, "PDir: PShortString; // fixme: PString->PShortString by unxed" в arcview.pas:
не помню уже, почему так сделано было [не понятно, хватит ли размера PShortString], но оставим пока так)

Коммит:
https://github.com/unxed/dn2l/commit/b4ff4ff

--

