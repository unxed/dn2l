
Сборка с отключенными warning и notes и выводом только 10 последних ошибок:
fpc -Se10 -vw-n- ./dn.pas

Не забываем добавлять // changed by unxed
и // added by unxed
и // commented by unxed
возле всех изменений,

и помечать изменения с потенциальной потерей функциональности как fixme.

--

Код:
    exrules: array[Low(THighliteRule)..Succ(High(THighliteRule))] of PChar;

Ошибка:
highlite.pas(1118,40) Error: range check error while evaluating constants (4 must be between 0 and 3)

Решение:
Добавить в THighliteRule дополнительное поле, а Succ убрать:
  THighliteRule = (
    hrCommentStarts,
    hrCommentStrings,
    hrKeywords1,
    hrKeywords2,
    hrExtra
    );
    // ...
    exrules: array[Low(THighliteRule)..High(THighliteRule)] of PChar;

Коммит:
https://github.com/unxed/dn2l/commit/5b020d7

--

Код:
      FC^.AtReplace(I, nil); {-$VOL}

Ошибка:
flpanelx.pas(604,11) Error: identifier idents no member "AtReplace"

Решение:
Заменить проблемную строчку на
      FC^.AtDelete(I);
      FC^.AtInsert(I, nil);
      {-$VOL}

Коммит:
https://github.com/unxed/dn2l/commit/a176a28

--

Код:
flpanelx.pas(759,12) Error: identifier idents no member "Sort"

Ошибка:
    Files^.Sort;

Тип Files — PFilesCollection, описан в filescol.pas
Наследуется от системной TSortedCollection.

Решение:
В системной TSortedCollection метода Sort нет:
https://www.freepascal.org/docs-html/rtl/objects/tsortedcollection.html
Закомментим пока вызов Sort (возможно, там автоматическая сортировка, но это не точно).

Коммиты:
https://github.com/unxed/dn2l/commit/739ff4b
https://github.com/unxed/dn2l/commit/6afaa63

--

Код:
PDir := NewStr(ArcName+':\')

Ошибка:
Error: Incompatible types: got "PShortString" expected "PString"

Решение:
Можно заменить проблемный код на
          AssignStr(PDir, ArcName+':\')
, но тогда всё ломается дальше, вот тут:
        UpFile^.Owner := PDir;

Поэтому поменял определение PDir на
      PDir: PShortString;

(см., например, "PDir: PShortString; // fixme: PString->PShortString by unxed" в arcview.pas:
не помню уже, почему так сделано было [не понятно, хватит ли размера PShortString], но оставим пока так)

Коммит:
https://github.com/unxed/dn2l/commit/b4ff4ff

--

Код:
      kbCtrlAltShift1, kbCtrlAltShift2, kbCtrlAltShift3,
      kbCtrlAltShift4, kbCtrlAltShift5, kbCtrlAltShift6,
      kbCtrlAltShift7, kbCtrlAltShift8, kbCtrlAltShift9:
...
      //kbBack, kbShiftBack:

Ошибка:
flpanelx.pas(2024,7) Error: Identifier not found "kbCtrlAltShift1"
и т.д.

Решение:
Закомментировал пока код, обрабатывающий эти сочетания клавиш. Они определены в commands.pas,
но не используются, т.к. подобные константы берутся из FV, а конкретно этих там нет.

Коммиты:
https://github.com/unxed/dn2l/commit/b92518f
https://github.com/unxed/dn2l/commit/7f35409

--

Код:
  Result := Min(CalcNameLength+1+CalcLengthWithoutName, MaxViewWidth);

Ошибка:
flpanelx.pas(3358,13) Error: Identifier not found "Min"

Решение:
uses
  math,

Коммит:
https://github.com/unxed/dn2l/commit/7701bce

--

Код:
    function GetText(Item: LongInt; MaxLen: Integer): String; virtual;
    function GetKey(var S: String): Pointer; virtual;

Ошибка:
phones.pas(106,14) Error: function header doesn't match the previous declaration "GetText(LongInt;LongInt):ShortString;"
phones.pas(107,14) Error: function header doesn't match the previous declaration "GetKey(var ShortString):^untyped;"

Там ниже есть реализация этих функций, поэтому, видимо, virtual лишний.

Решение:
    function GetText(Item: LongInt; MaxLen: Integer): String;// virtual;
    function GetKey(var S: String): Pointer;// virtual;

--

Код:
  Number := GetNum;

Ошибка:
printman.pas(148,13) Error: Identifier not found "GetNum"

Решение:
Комментируем эту строчку. Number это номер окна в TWindow, а GetNum вообще не ищется по коду.
В dnfuncs.pas ещё такое есть: GetWinNumber: Views.GetNum;

Коммит:
https://github.com/unxed/dn2l/commit/b2e8e60

--

Проблема:
Функция DisposeStr не найдена

Решение:
Меняем на Dispose

Коммит:
https://github.com/unxed/dn2l/commit/58175a3

--

Проблема: функция NewStr не найдена

Решение: меняем её AssignStr

Коммиты:
https://github.com/unxed/dn2l/commit/399fe99
https://github.com/unxed/dn2l/commit/2dbc380

--

Код:
        Pointer(L[0]) := @EditName;

Ошибка:
microed2.pas(251,9) Error: Typecast has different size (4 -> 8) in assignment

Массив L из Longint. В 32-битной системе, Pointer и LongInt имеют один и тот же размер в памяти (4 байта),
но в 64-битной системе Pointer занимает 8 байт. На 64-битной системе возникает ошибка.

Решение:
        L[0] := LongInt(PtrInt(@EditName));
        //Pointer(L[0]) := @EditName; // fixme: changed by unxed

Коммит:
https://github.com/unxed/dn2l/commit/de9a825

--

Ошибка:
microed2.pas(769,11) Error: function header doesn't match the previous declaration "MIStore(PFileEditor;var TStream);"
microed2.pas(69,11) Error: Found declaration: MIStore(PFileEditor;var TStream);
microed2.pas(804,11) Error: function header doesn't match the previous declaration "MILoad(PFileEditor;var TStream);"
microed2.pas(70,11) Error: Found declaration: MILoad(PFileEditor;var TStream);

Возможно, в uses подхватывается новое определение TStream, которое перекрывает предыдущее.

Решение:
закомментируем пока эти две функции:
//procedure MIStore(AED: PFileEditor; var S: TStream);
//procedure MILoad(AED: PFileEditor; var S: TStream);
и их реализации. Попробуем без них собрать.
